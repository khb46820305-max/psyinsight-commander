# 알림 미작동 문제 해결 가이드

## 🔍 확인된 사항

### ✅ 정상 설정
- 알림 권한 (POST_NOTIFICATIONS): ✅ 있음
- 부팅 완료 수신 권한 (RECEIVE_BOOT_COMPLETED): ✅ 있음
- 정확한 알람 스케줄 권한 (SCHEDULE_EXACT_ALARM): ✅ 있음
- 기타 권한 (VIBRATE, WAKE_LOCK): ✅ 있음

---

## ❌ 알림이 오지 않는 가능한 원인

### 1. Android 12+ 정확한 알람 권한 미허용
**문제:**
- Android 12 이상에서는 `SCHEDULE_EXACT_ALARM` 권한을 사용자가 수동으로 허용해야 함
- 권한이 없으면 정확한 시간에 알림이 오지 않음

**해결 방법:**
1. 설정 > 앱 > [앱 이름] > 권한
2. "정확한 알람 및 리마인더" 권한 확인
3. 없으면 수동으로 허용

**코드에서 확인:**
```dart
// Flutter 코드에서 권한 요청 필요
if (await canScheduleExactAlarms()) {
  // 알람 스케줄링
} else {
  // 권한 요청
  await requestExactAlarmsPermission();
}
```

---

### 2. 배터리 최적화
**문제:**
- Android가 배터리 절약을 위해 앱을 백그라운드에서 종료
- 알림 스케줄이 취소됨

**해결 방법:**
1. 설정 > 배터리 > 배터리 최적화
2. 앱 찾기
3. "최적화 안 함" 선택

**또는:**
- 설정 > 앱 > [앱 이름] > 배터리
- "무제한" 또는 "최적화 안 함" 선택

---

### 3. 앱 자동 시작 권한
**문제:**
- 일부 제조사(삼성, 샤오미 등)에서 앱 자동 시작을 막음
- 재부팅 후 알림이 작동하지 않음

**해결 방법:**
- 설정 > 앱 > 자동 시작 관리
- 앱을 "허용"으로 설정

---

### 4. 알림 채널 미생성
**문제:**
- Android 8.0+ 에서는 알림 채널이 필수
- 채널이 생성되지 않으면 알림이 표시되지 않음

**확인 방법:**
- 앱 최초 실행 시 알림 채널 생성 코드가 실행되는지 확인
- 설정 > 앱 > 알림에서 채널이 있는지 확인

**코드 예시:**
```dart
// Flutter Local Notifications
await flutterLocalNotificationsPlugin
    .resolvePlatformSpecificImplementation<
        AndroidFlutterLocalNotificationsPlugin>()
    ?.createNotificationChannel(channel);
```

---

### 5. 알림 스케줄링 코드 오류
**가능한 문제:**
- 매일 반복 스케줄이 제대로 설정되지 않음
- 시간대(timezone) 문제
- 앱이 종료되면 스케줄이 사라짐

**확인 사항:**
- WorkManager 또는 AlarmManager 사용 여부
- 매일 반복 로직 구현 여부
- 부팅 후 재등록 로직 여부

---

## 🔧 즉시 확인할 사항

### 1. 기기 설정 확인
```
✅ 설정 > 앱 > [앱 이름] > 알림 > 허용
✅ 설정 > 앱 > [앱 이름] > 배터리 > 무제한
✅ 설정 > 앱 > [앱 이름] > 권한 > 정확한 알람 허용
✅ 설정 > 배터리 > 배터리 최적화 > 앱 제외
```

### 2. 앱 내 확인
- 앱을 실행하고 알림 설정 화면 확인
- 알림이 활성화되어 있는지 확인
- 테스트 알림 버튼이 있다면 실행

### 3. 로그 확인
```bash
# Android 로그캣으로 확인
adb logcat | grep -i notification
adb logcat | grep -i alarm
```

---

## 💡 권장 해결 순서

1. **앱 재설치**
   - 앱 삭제 후 재설치
   - 최초 실행 시 권한 요청 확인

2. **권한 수동 확인**
   - 설정에서 모든 권한 허용 확인
   - 특히 "정확한 알람" 권한

3. **배터리 최적화 해제**
   - 앱을 배터리 최적화에서 제외

4. **앱 재시작**
   - 앱 완전 종료 후 재시작
   - 알림 스케줄이 재등록되는지 확인

5. **테스트 알림**
   - 앱에서 테스트 알림 기능이 있다면 실행
   - 1-2분 후 알림 설정으로 즉시 테스트

---

## 🐛 코드 레벨 확인 필요 사항

### Flutter 코드에서 확인:
1. `flutter_local_notifications` 플러그인 사용 여부
2. `workmanager` 또는 `android_alarm_manager` 사용 여부
3. 매일 반복 스케줄 구현 여부
4. 부팅 후 재등록 로직 여부
5. 알림 채널 생성 코드 여부

### 예상 코드 구조:
```dart
// 매일 7시 30분 알림 스케줄링
await scheduleDailyNotification(
  hour: 7,
  minute: 30,
  notificationId: getDayOfYear(), // 1-365
  title: '오늘의 메시지',
  body: getPreviewText(getDayOfYear()),
);
```

---

## 📝 체크리스트

- [ ] Android 12+ 정확한 알람 권한 허용
- [ ] 배터리 최적화 해제
- [ ] 앱 자동 시작 권한 허용
- [ ] 알림 채널 생성 확인
- [ ] 앱 재시작 후 알림 스케줄 재등록 확인
- [ ] 테스트 알림 작동 확인
- [ ] 다음날 7시 30분 알림 확인

---

## ⚠️ 주의사항

1. **Android 버전별 차이**
   - Android 12+ : 정확한 알람 권한 필수
   - Android 8.0+ : 알림 채널 필수
   - 제조사별 추가 설정 필요 (삼성, 샤오미 등)

2. **앱 종료 시**
   - 앱이 완전히 종료되면 알림이 작동하지 않을 수 있음
   - WorkManager 사용 권장 (앱 종료 후에도 작동)

3. **시간대 문제**
   - UTC vs 로컬 시간 확인
   - 일광절약시간 고려

---

## 🔍 추가 디버깅

앱 개발자라면 다음을 확인:
1. Flutter 코드에서 알림 스케줄링 로직 확인
2. 로그캣으로 알림 등록/발송 로그 확인
3. WorkManager 또는 AlarmManager 사용 여부 확인
4. 부팅 후 재등록 로직 확인
